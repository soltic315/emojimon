# Emojimon AI作業ガイド

このドキュメントは、AIエージェントと人間開発者が同じ基準で作業するための実行ガイドです。  
最優先は「安全・一貫性・最小差分」で、仕様変更時は必ず関連ドキュメントを同期します。

## 0. ルールの優先順位

- 本リポジトリでの作業では、`AGENTS.md` に記載された規約を最優先で適用する。
- AIに与えられる実行指示（開発者向けプロンプト等）と矛盾する場合は、`AGENTS.md` の規約を優先する。

---

## 1. 目的

- 本プロジェクトはブラウザゲーム `Emojimon` の継続開発を行う。
- AIは要件把握 → 実装 → 検証 → ドキュメント更新までを一貫して担当する。
- 体験品質の目標は「軽快な操作感」と「破綻しない進行」。

---

## 2. 作業フロー ★重要

1. 変更対象と依存ファイルを確認する。
2. 最小差分で実装する。
3. コードの変更がある場合のみ、`npm run lint` / `npm run typecheck` / `npm run test` / `npm run build` を優先度順で確認し、Build成功まで確認する。
  - 検証コマンドは必ず逐次実行し、前のコマンドの完了（成功/失敗）を確認してから次のコマンドを実行する（同時実行・完了前の次コマンド投入は禁止）。
4. 仕様に影響する場合、`GAME_DESIGN.md` を更新する。
5. 導入・運用に影響する場合、`README.md` を更新する。
6. コードの変更がある場合のみ、セマンティックバージョニングの原則に従い、変更の種類に応じて適切なバージョン番号を更新する。
7. コードの変更がある場合のみ、AIとのチャット完了後に `CHANGELOG.md` を更新する。

---

## 3. 言語・表記ルール

- コミュニケーション: 日本語
- コードコメント: 日本語
- 技術文書: 日本語
- 変数名・関数名・型名: 英語
- ユーザー向け文言: 既存のトーン（日本語）を維持

---

## 4. 著作権・命名ルール

- 既存の有名IP名や固有名詞と完全一致する名称は新規追加しない。
- 既存データを拡張する際も、独自名を採用する。
- 参照・説明時は「○○風」表現に留め、同一名称の流用を避ける。

---

## 5. 技術スタック（現行）

- TypeScript（ES Modules）
- Phaser 3
- Vite
- ESLint / TypeScript / Vitest
- データ定義: `assets/data/*.json`

---

## 6. 主要ディレクトリ

```
assets/data/            # ゲームデータ（モンスター/技/アイテム/特性）
js/
  audio/                # サウンド
  data/                 # データ処理・ルール
  scenes/               # Scene本体
    battle/             # バトルUI/定数
    menu/               # メニューUI/定数
    world/              # マップ定義/ショップ
  state/                # グローバル状態
  ui/                   # 共通UI/タッチ操作
tests/                  # ユニットテスト
```

---

## 7. 編集ポリシー

- シーンに閉じるロジックはシーン内に置く。
- 複数シーンで使う処理は `js/data` または `js/ui` に寄せる。
- JSON構造は互換性を崩さない（既存キーを尊重する）。
- UIは既存のヘルパー・トークンを優先し、独自ルールを増やしすぎない。
- 無関係なリファクタリングを同時に行わない。
- 入力はアクション（confirm/cancel/navigation）単位で統一し、シーンごとの直接キー判定を増やしすぎない。
- 決定操作は全画面で `Z / Enter / Space`、キャンセル操作は `X / ESC` を標準とする。
- `dialog` / `choice` / `battlePending` など入力ロック中は、移動・メニュー・再話しかけを受け付けない。
- リストUI（メニュー/ショップ/図鑑など）は上下キー長押しリピート移動を標準対応し、しきい値は共通定数で管理する。

---

## 8. テスト・検証

- データ変更時: 関連テストとバリデーションを実行する。
- バトル変更時: 勝敗・状態異常・捕獲・逃走を最低1回ずつ手動確認する。
- ワールド変更時: 遷移・衝突・イベント発火を確認する。
- 不具合修正時: 再発防止のためテスト追加を検討する。
- コード変更完了時: `npm run build` が成功することを確認する。
- 入力仕様変更時: Title / World / Dialog / Menu / Battle / Shop で、決定・キャンセル・長押しを最低1回ずつ手動確認する。
- 入力競合修正時: 会話中・選択中・遷移待機中に、メニュー起動や再入力が発生しないことを確認する。

---

## 9. ドキュメント責務

- `README.md`: セットアップ・開発手順・運用情報（仕様詳細は書かない）
- `GAME_DESIGN.md`: ゲーム仕様の一次情報（ルール・数式・進行）
- `AGENTS.md`: AI/開発者向け作業規約
- `CHANGELOG.md`: 変更履歴の一次情報（作業ごとに更新）

---

## 10. 完了条件チェックリスト ★重要

- [ ] 変更範囲が要求に一致している
- [ ] （コード変更時）型・Lint・テスト・Buildに新規エラーがない
- [ ] 仕様変更が `GAME_DESIGN.md` に反映されている
- [ ] 運用変更が `README.md` に反映されている
- [ ] 命名が著作権リスク回避方針に沿っている
- [ ] （コード変更時）バージョン番号が適切に更新されている
- [ ] 入力共通仕様（決定/キャンセル/長押し）が対象画面で維持されている
- [ ] 入力ロック中（dialog/choice/battlePending）に競合操作が発生しない
- [ ] （コード変更時）`CHANGELOG.md` が更新されている
- [ ] （コード変更時）`CHANGELOG.md` の見出し・項目が `Note / Added / Changed / Fixed / Prompt` に準拠している