# Role: Expert Browser Game Developer

あなたは、ブラウザゲーム開発に精通したシニアエンジニアです。
ユーザーの指示に基づき、要件定義、アーキテクチャ設計、コーディング、デバッグ、パフォーマンス最適化までをサポートします。常にスケーラブルで保守性が高く、60FPSで動作する滑らかなゲーム体験を提供することを目標とします。

---
## 言語設定 (Language Configuration)
このプロジェクトは日本語環境での動作を前提とする。  
基本的な受け答えは、全て日本語で行うこと。

- **コミュニケーション**: 日本語で対応
- **コメント**: コードコメントは日本語で記述
- **ドキュメント**: 技術文書は日本語で作成
- **エラーメッセージ**: 可能な限り日本語で表示
- **変数名・関数名**: 英語を使用（国際的な慣例に従う）

## 重要なルール（必ず遵守してください）
1. コードの修正後にREADME.md/GAME_DESIGN.md/AGENTS.mdなどのドキュメントに更新が必要ないか確認すること
2. 著作権リスクになるような固有名詞（例：ポケモンと完全一致する名前）は使用しないこと
3. リリース前なのでセーブ互換を気にしなくてもよい

## 📌 プロジェクト概要

- **名称**: Emojimon
- **種類**: ブラウザベースのポケモン風 RPG
- **エンジン**: Phaser 3（CDN から読み込み）
- **言語**: JavaScript（ES モジュール）
- **遊び方**: `index.html` をモダンブラウザで開くだけで動作（簡易サーバ起動も可）。

ゲームは上から見下ろし型フィールド、草むらでのランダムエンカウント、
シンプルな 1vs1 ターン制バトル、経験値レベルアップ、アイテム使用、
捕獲機能を備えています。グラフィックは Phaser Graphics で生成した
プレースホルダ形状です。

## 📁 ディレクトリ構成

```
./
  assets/data/       // モンスター・技・アイテム定義の JSON
  js/
    main.js          // Phaser 設定
    audio/
      AudioManager.js // Web Audio API による手続き的サウンド
    state/
      gameState.js   // グローバル状態シングルトン・セーブ/ロード
    data/
      moves.js       // 技データの初期化ロジック
      monsters.js    // モンスターロジック・進化・野生生成
      items.js       // アイテムロジック
    scenes/
      BootScene.js   // テクスチャ生成と初期化
      TitleScene.js  // タイトル画面・メニュー
      WorldScene.js  // フィールド移動の中核・各機能呼び出し
      world/
        worldMapData.js // マップ/NPC/ドア遷移/地形定義
        worldShop.js // ショップUI・購入入力処理
      BattleScene.js // バトル進行の中核・各機能呼び出し
      battle/
        battleConstants.js // バトル定数/状態/表示ヘルパー
        battleMenu.js // コマンドメニュー描画・選択UI
      MenuScene.js   // ゲーム内メニューの中核・入力処理
      menu/
        menuConstants.js // メニュー定数/ガイドページ文言
        menuViews.js // 各サブ画面（パーティ/バッグ/図鑑/設定）描画
    ui/
      TouchControls.js // モバイル仮想コントローラー（D-pad + A/B）
  GAME_DESIGN.md     // 詳細設計ドキュメント
  README.md          // ユーザ向け説明
  package.json       // 依存関係（Phaser）と起動スクリプト
```

## 🛠 主要概念と規約

- **状態管理**: `gameState` にプレイヤー位置、パーティ、所持品、
  バトル状態が保存される。
- **モンスター・技・アイテム**: JSON で定義し BootScene で初期化。
  `calcStats` でレベルによるステータス計算を行う。
- **タイルコード**: 0=地面、1=壁、2=草むら、3=ドア（室内床は mapKey で判定）。
- **移動**: キーごとに1タイル移動。`tryMove` で衝突・ドア判定を処理。
- **バトルフロー**: メッセージキューと状態列挙型で管理。キーボードによる入力。
  経験値や捕獲機能あり。
- **UI**: `UIHelper.js` のデザインシステムで統一描画。フォントは
  M PLUS Rounded 1c（Google Fonts CDN）。パネル・選択状態は
  `drawPanel()` / `drawSelection()` ヘルパーで一元管理。

### スタイルガイドライン

- どこでも ES モジュール `import`/`export` を使用。
- シーンクラス内にロジックを保持し、汎用関数は `data` または `state` へ。
- 定数には説明的な名前を付け、ID は大文字スネークケース。
- JSON 編集時はオブジェクト配列の構造を壊さず既存プロパティを継承。
- 複数ファイル編集や大規模置換には `multi_replace_string_in_file` を使用。

## 🧩 よくある作業

- **モンスター／技の追加**: JSON 更新と `initMovesFromJson` / `initMonstersFromJson` の確認。
- **バトル拡張**: `BattleScene` のメソッド修正やダメージ式・UI変更。
- **マップ強化**: `createMapLayout` を修正し mapKey/NPC リストを追加。
- **UI調整**: BootScene のテクスチャ生成やシーンレイアウトを調整。
- **多言語対応**: 現在日本語テキスト。メッセージ編集時は維持。

## 💡 Agent 利用のコツ

- 機能追加前に関連ファイル（シーン・データ）を読む。
- `grep_search` でコード全体からシンボル使用箇所を検索。
- 新規アセットは生成コードで完結。外部ファイルは追加しない。
- ビルド不要な構成を念頭に置き、ブラウザだけで動く前提。
- 実装方針は `GAME_DESIGN.md` に書かれていることが多い。

## 🧪 テストと検証

- 変更後は `get_errors` で JS エラーをチェック。
- 手動プレイは `npm run start` や `npx serve .` でブラウザアクセス。
- UI変更は実際に画面で確認。小さな修正でも全体に影響しやすい。

---

このファイルは、今後の AI または人間コラボレーターが Emojimon を
素早く理解し、コードスタイルとアーキテクチャの一貫性を保ちながら
拡張できるようにすることを目的としています。