# EMOJIMON ゲーム設計書

## 概要

**タイトル**: EMOJIMON（エモジモン）  
**ジャンル**: ポケモン風・2D ターン制バトル RPG（ブラウザゲーム）  
**ターゲット**: カジュアルゲーマー〜RPG 好き（10〜40 歳）  
**対応環境**: 最新の Chrome / Edge / Firefox / Safari（PC 推奨）

絵文字をモチーフにしたモンスターを育成しながら、シンプルなマップを探索し、
ランダムエンカウントでターン制バトルを行うブラウザゲームです。
      mapRules.ts    // マップ依存ルール（遭遇・天候・背景テーマ）
セーブ/ロード機能、進化システム、ジムバトル、複数エリアマップなどを備えた
製品レベルの完成度を持つゲームです。

---

## ゲームコンセプト

- **シンプルだが奥行きのあるバトル**
  - タイプ相性（炎・水・草・ノーマル・電気・氷）を活用した駆け引き。
  - 攻撃・防御・素早さステージ補正と変化技による戦略性。
  - PP制限によるリソース管理。
  - 命中率・優先度・素早さによる行動順決定。
  - いれかえコマンドによる戦術的なパーティ運用。
- **短時間で遊べるループ**
  - 1 バトルあたり 1〜3 分。
  - レベルアップ・進化・図鑑埋めのやりこみ要素。
  - 日替わりチャレンジ達成による再訪動機。
- **長編メイン導線（約10時間）**
  - エリアごとの試験トレーナー（森/洞窟/ダークタワー/火山/氷峰/遺跡）を突破して進行資格を解放。
  - 捕獲数・戦闘数・平均レベル・闘技場3連戦クリアを組み合わせたゲートで段階的に開放。
  - 最終決戦は「遺跡の守人試練」達成後に挑戦可能。
- **絵文字モンスターによる直感的な世界観**
  - 手続き生成タイルの多バリアント描画とガラス調HUDで視認性と質感を両立。

---

## コアゲームループ

1. **フィールド移動**
  - 町（エモじタウン）→ 森（エモの森）→ 洞窟（きらめき洞窟）→ マグマ峠 → 氷峰 → そらの遺跡を探索。
  - サイドルート: 洞窟 → ダークタワー。クリア後隠しエリア: そらの遺跡 → 天空の花園。
2. **ランダムエンカウント**
   - 草むら・森タイル上で一定確率で野生モンスターが出現。
3. **バトル**
   - ターン制の 1vs1 バトル。
   - たたかう / アイテム / つかまえる / にげる。
4. **成長**
   - 経験値獲得 → レベルアップ → 進化。
   - お金獲得 → ショップでアイテム購入。
5. **目標**
   - ジムリーダーを倒してジムバッジを獲得。
   - 図鑑の完成を目指す。
  - メインストーリーは育成・探索・試験戦を通して約10時間でのクリアを想定。

---

## システム仕様

### 1. フィールド移動システム

- **視点**: トップダウン 2D
- **マップ**: グリッドベース（32x32 px タイル）
- **エリア**:
  - **エモじタウン** (25x20): メインの町。ショップ、NPC、草むら、家。
  - **おうち** (12x10): 室内マップ。回復NPC。
  - **エモの森** (25x20): 森林マップ。レア野生モンスター、池、ジム。
  - **きらめき洞窟** (25x20): 高難度マップ。高レベル野生モンスターが出現。
  - **ダークタワー** (22x18): ダーク団アジト。サイドルート（洞窟から分岐）。
  - **マグマ峠** (28x22): 中上級マップ。火山地帯固有の出現テーブル。
  - **氷峰** (26x20): 氷のジムリーダー・ユキハが待つ。第2ジム。
  - **そらの遺跡** (30x22): 最深部マップ。遺跡固有の高レベル出現テーブル。
  - **天空の花園** (28x20): クリア後の隠しエリア。伝説のモンスター。

#### タイルコード

| コード | 種類 | 説明 |
|--------|------|------|
| 0 | 地面 | 通常の歩行可能タイル |
| 1 | 壁 | 通行不可 |
| 2 | 草むら | ランダムエンカウント発生 |
| 3 | ドア | マップ遷移 |
| 4 | 森 | レア野生出現（低確率） |
| 5 | 水 | 通行不可（装飾） |
| 6 | ジム | ジムバトル発生 |
| 7 | 道 | 装飾付き歩行可能タイル |

#### 操作

| キー | 機能 |
|------|------|
| ←↑→↓ | 移動（離散ステップ） |
| Z | 決定 / NPC会話 |
| X / ESC | メニューを開く / キャンセル |
| P | セーブ |

#### マップ遷移

- ドアタイルを踏むとフェードアウト → フェードインで遷移。
- エモじタウン東出口 → エモの森。
- 家のドア → おうち入口。
- **マップ遷移時にオートセーブ**が実行される。

#### ミニマップ

- 画面右上にリアルタイムでミニマップを表示。
- タイルの種別に応じた色分け（地面=暗緑、壁=灰、草=黄緑、水=青など）。
- プレイヤー位置が黄色の点滅ドットで表示される。
- HUDパネルは角丸・ヘッダー・発光を持つ統一デザインで描画し、通知メッセージは下部ガラスパネルに表示する。

#### タイプ探索アクション

- **FIRE**: マグマ峠の氷ブロックを溶かして隠しルートを開通。
- **WATER**: エモの森の特定水面を泳いで小島の報酬アイテムを取得。
- **ELECTRIC**: きらめき洞窟で暗闇の隠しアイテムを可視化し、回収可能にする。
- 取得済みの探索報酬フラグはセーブデータに保存される。

#### ゲーム内メニュー（X/ESCキー）

フィールドからアクセス可能な包括的メニュー：

- **パーティ**: モンスターのHP/ステータス確認、並び替え、合成
  - 合成は2体選択式（ベース + 素材）。素材は消費され、ベースは経験値獲得とHP回復を行う
  - 特定の組み合わせはレシピ合成となり、ベースが別モンスターに変化する
  - レシピ成立時は発見履歴に保存され、パーティ画面下部に絵文字レシピ候補を表示する
- **ボックス**: パーティ外に預けているモンスター一覧
  - パーティに空きがある場合: Zキーでそのままパーティに追加
  - パーティが満員の場合: 交換したいパーティメンバーを選んで入れ替え
- **バッグ**: 所持アイテム一覧と説明文。回復系アイテム（ヒールジェル/エリクサー/リバイブシャード/エーテル/マックスエリクサー）をフィールドからパーティメンバーに使用可能
- **ずかん**: 見つけた/捕まえたモンスター図鑑（スクロール対応）
- **トレーナー**: プレイ時間、バトル・捕獲回数、ジム/クエスト状況
  - 日替わりチャレンジ（本日の目標・進捗・報酬）を表示
- **ガイド**: 操作方法、探索/遭遇、天候・状態異常・タイプ相性、捕獲/逃走、成長・進行の基礎説明
- **設定**: ミュート、BGM/SE音量調整、セーブデータ削除
  - バトル速度（ノーマル/はやい/さいこうそく）、メッセージ自動送り、エンカウント演出短縮を切替可能
  - セーブデータ削除を実行するとタイトル画面へ戻る

#### 日替わりチャレンジ

- ローカル日付ごとに 1 つの目標を生成。
- 目標タイプは以下のいずれか:
  - `BATTLE`: 指定回数のバトルを開始する
  - `CATCH`: 指定回数の捕獲に成功する
  - `ARENA_CLEAR`: 闘技場3連戦をクリアする
- 進捗は対応イベントで自動更新される。
- 達成時にその場で追加G報酬を受け取る。
- チャレンジ状態（日付・目標・進捗・報酬受取状態）はセーブデータに保存される。

---

### 2. ランダムエンカウントシステム

- **草むらタイル (2)**: 移動時 25% の確率でエンカウント。
- **森タイル (4)**: 移動時 12% の確率でエンカウント。
- エンカウント時は3連フラッシュ + フェード演出。
- **出現テーブル**:
  - 草むら: `wildPoolIds` から選出（Lv.3〜5）。
  - 森: `forestPoolIds` から選出（Lv.5〜8）。
  - 洞窟: `cavePoolIds` から選出（Lv.8〜12）。
  - ダークタワー: `darkTowerPoolIds` から選出（Lv.18〜24）。
  - 火山: `volcanoPoolIds` から選出（Lv.12〜16）。
  - 氷峰: `frozenPeakPoolIds` から選出（Lv.22〜28）。
  - 遺跡: `ruinsPoolIds` から選出（Lv.15〜20）。
  - 天空の花園: `gardenPoolIds` から選出（Lv.25〜35）。

---

### 3. バトルシステム

#### 戦闘フロー

1. **イントロ**: 「野生の◯◯がとびだしてきた！」→ フェードイン。
2. **プレイヤーターン**: コマンド選択（たたかう/アイテム/いれかえ/つかまえる/にげる）。
3. **行動順決定**: 優先度比較 → 素早さ比較（まひ時半減、speedStageで補正） → 同速ランダム。
4. **攻撃演出**: 突進アニメーション → ヒットパーティクル → ダメージ数字 → 画面シェイク。
5. **HP バーアニメーション**: Tween で滑らかに変動（色も緑→橙→赤に変化）。
6. **相手ターン**: AI がタイプ相性・威力・命中を加味して技を選択。
7. **勝敗判定**: 経験値・お金・進化チェック。バトル後にオートセーブ。

#### バトル画面の演出

- **環境別バトル背景**: マップに応じた動的背景描画
  - 町: 青い夜空 + 星の瞬き
  - 森: 深緑の背景 + 木のシルエット + 光のフィルタ
  - 洞窟: 暗い岩壁 + きらめくパーティクル + 鍾乳石
- **背景の多層表現**: 遠景グロー・周辺ビネット・地面ハイライトで奥行きを補強
- **タイプバッジ**: モンスターのタイプをカラーコード付きバッジで表示
- **カメラシェイク**: 急所ヒットやばつぐん時にカメラが揺れる
- **撃破演出**: 倒されたモンスターが縮小+フェードアウト
- **レベルアップ演出**: 星のパーティクルバースト + カメラフラッシュ
- **進化演出**: 白いフラッシュ + スケールアニメーション + 絵文字変化
- **経験値共有**: バトル勝利時、リーダーが100%、他のパーティメンバーが30%の経験値を得る
- **コマンドUI**: 行カードにアイコン・左アクセント・選択グロウを持つ高視認メニューを採用

#### エモ・スキップ（一括オートバトル）

レベル差が **10以上** ある野生モンスターとの戦闘時、面倒な操作なしでバトルを一瞬でクリアできる「エモ・スキップ」機能。
ソーシャルゲームで定番の「スキップチケット」的な体験を、課金要素なしでレベル差による条件解禁で実現している。

- **発動条件**: 野生バトルかつプレイヤー先頭モンスターのレベルが相手より10以上高い
- **操作方法**: Zキー長押し（600ms）でスキップ発動
- **演出**: 黄色のプログレスバーがチャージ → フラッシュ → 相手即撃破
- **報酬**: 通常勝利と同じ（経験値・お金・連勝ストリーク・図鑑登録）
- **対象外**: ボス・トレーナー・闘技場バトルでは使用不可
- **UI**: バトル画面下部に `⚡ Zキー長押しで エモ・スキップ ⚡` のパルスアニメーション付きヒント表示

補足仕様:
- ダメージ計算に急所判定（12.5%、最終ダメージ1.5倍）を適用。
- 先頭モンスターが戦闘不能になった場合、パーティ内の生存モンスターに自動交代。
- やけど状態異常を実装（毎ターン開始時に最大HPの10%ダメージ、物理わざ威力0.75倍）。
- どく状態異常を実装（毎ターン開始時に最大HPの8%ダメージ）。
- まひ状態異常を実装（25%の確率で行動不能、素早さ半減）。
- こおり状態異常を実装（20%の確率で解凍、それ以外は行動不能）。
- ねむり状態異常を実装（ターン経過または33%の確率で起床、それ以外は行動不能）。
- 特性システムを実装（バトル開始時に表示、条件を満たすとダメージ計算に反映）。
- 素早さベースの行動順決定システムを実装。
- PP（パワーポイント）制限を実装。各技に使用回数制限あり。
- バトル中のいれかえコマンドを実装。
- パーティ上限6体制限。超過分はボックスに送られる。
- エレメント連鎖を実装。
  - **感電リアクション**: 対象が「ぬれ」状態 / 雨天 / 直前に水技を使用した場合、ELECTRIC 技で追加固定ダメージ。
  - **蒸気爆発リアクション**: FREEZE 状態の対象に FIRE 技を当てると解凍 + 追加ダメージ + 2ターン命中率低下。

#### 特性システム

| 特性ID | 表示名 | 効果 |
|--------|--------|------|
| BLAZE | えんしん | HPが1/3以下のとき、FIREわざ威力1.25倍 |
| TORRENT | りゅうすい | HPが1/3以下のとき、WATERわざ威力1.25倍 |
| OVERGROW | しげみ | HPが1/3以下のとき、GRASSわざ威力1.25倍 |
| STURDY | いわかべ | 受けるダメージを0.9倍 |
| MOTOR_DRIVE | らいどう | HPが1/3以下のとき、ELECTRICわざ威力1.25倍 |
| ICE_BODY | ひょうがい | HPが1/3以下のとき、ICEわざ威力1.25倍 |
| INTIMIDATE | あつりょく | 相手のダメージを0.92倍 |
| SWIFT_SWIM | かそくひれ | 相手のダメージを0.9倍 |

- `assets/data/monsters.json` の各モンスターに `abilityId` を設定可能。
- 特性マスタは `assets/data/abilities.json` から起動時に読み込む。
- `abilityId` 未指定時はタイプ別デフォルト（FIRE→BLAZE / WATER→TORRENT / GRASS→OVERGROW / NORMAL→STURDY / ELECTRIC→MOTOR_DRIVE / ICE→ICE_BODY）。

#### 天候システム

バトル開始時にマップに応じたランダム天候が設定される。天候は4〜7ターン持続し、終了後8%の確率で新しい天候が発生する。

| 天候 | 表示 | 強化タイプ (1.3倍) | 弱体タイプ (0.7倍) |
|------|------|-------------------|-------------------|
| はれ (SUNNY) | ☀️ はれ | FIRE | WATER, ICE |
| あめ (RAINY) | 🌧️ あめ | WATER, ELECTRIC | FIRE |
| かぜ (WINDY) | 💨 かぜ | GRASS | — |
| なし (NONE) | — | — | — |

- 天候発生確率はマップごとに異なる（町: 50%, 森: 70%, 洞窟: 30%）。
- 画面上部に天候表示アニメーション（パルスエフェクト）。
- ダメージ計算に天候倍率が乗算される。

#### コマンド

| コマンド | 説明 |
|----------|------|
| つかまえる | ボール消費で捕獲試行（ボス戦では不可） |
| たたかう | 技選択 → 攻撃（PP消費） |
| アイテム | 戦闘用アイテム使用 |
| いれかえ | パーティの別のモンスターに交代（相手のターンが先に来る） |
| にげる | 60% の確率で逃走（ボス戦では不可） |

#### ダメージ計算式

$$
\text{Damage} = \left(\frac{2 \cdot Lv}{5} + 2\right) \cdot \frac{\text{Power} \cdot Atk \cdot AtkMult}{Def \cdot DefMult} / 50 + 2
$$

乗算補正:
- **タイプ相性**: 2.0 / 0.5 / 1.0
- **STAB（タイプ一致）**: 1.2 倍
- **乱数**: 0.88〜1.12
- **ステージ補正**: `1 + stage × 0.25`（最低 0.25）

#### タイプ相性

| 攻撃＼防御 | FIRE | WATER | GRASS | NORMAL | ELECTRIC | ICE |
|------------|------|-------|-------|--------|----------|-----|
| FIRE | 0.5 | 0.5 | 2.0 | 1.0 | 1.0 | 2.0 |
| WATER | 2.0 | 0.5 | 0.5 | 1.0 | 0.5 | 1.0 |
| GRASS | 0.5 | 2.0 | 0.5 | 1.0 | 1.0 | 0.5 |
| NORMAL | 1.0 | 1.0 | 1.0 | 1.0 | 1.0 | 1.0 |
| ELECTRIC | 1.0 | 2.0 | 0.5 | 1.0 | 0.5 | 1.0 |
| ICE | 2.0 | 0.5 | 2.0 | 1.0 | 1.0 | 0.5 |

---

### 4. モンスター仕様

#### ステータス計算

```
maxHp   = baseHp + 3 × (level - 1)
attack  = baseAttack + 1 × (level - 1)
defense = baseDefense + 1 × (level - 1)
speed   = baseSpeed + floor((level - 1) / 2)
```

#### 経験値テーブル

```
nextLevelExp = 10 + 8 × level
```

#### データ項目（追加）

- `abilityId`（任意）: モンスターの特性ID。

#### モンスター一覧（60体）

| ID | 名前 | 絵文字 | タイプ | 説明 |
|----|------|--------|--------|------|
| EMBEAR | エムベア | 🧸 | FIRE | 初期モンスター。Lv12でパイアベアに進化。 |
| PYREBEAR | パイアベア | 🔥 | FIRE | エムベアの進化形。ジムボスが使用。 |
| DROPLET | ドロプレット | 💧 | WATER | 水タイプ。Lv14でタイダロンに進化。 |
| TIDALON | タイダロン | 🌊 | WATER | ドロプレットの進化形。 |
| LEAFLING | リーフリング | 🌿 | GRASS | 草タイプ。Lv13でソーンキングに進化。 |
| THORNKING | ソーンキング | 🌳 | GRASS | リーフリングの進化形。 |
| STARLITE | スターライト | ⭐ | NORMAL | レアモンスター。クエスト対象。 |
| BLAZEBIRD | ブレイズバード | 🐦 | FIRE | 炎の鳥。攻撃力が高い。 |
| AQUASHELL | アクアシェル | 🐢 | WATER | 亀型。防御力が高い。 |
| THORNVINE | ソーンバイン | 🌵 | GRASS | サボテン型。森に生息。 |
| SHADOWPAW | シャドウポー | 🐾 | NORMAL | 影の獣。素早さが高い。 |
| CRYSTALINE | クリスタライン | 💎 | NORMAL | 結晶型。バランスタイプ。 |
| MAGMOG | マグモグ | 🌋 | FIRE | 洞窟に生息する高火力モンスター。 |
| RIPPLYNX | リップリンクス | 🦭 | WATER | 洞窟湖に生息する水棲モンスター。 |
| BRAMBLEON | ブランブルオン | 🍀 | GRASS | 結晶草原の守護者。耐久寄り。 |
| MOONMITE | ムーンマイト | 🌙 | NORMAL | 洞窟深部に現れる希少種。 |
| CINDERCUB | シンダーカブ | 🦊 | FIRE | 炎狐。Lv16でヴォルカノックスに進化。 |
| VOLCANOX | ヴォルカノックス | 🗻 | FIRE | マグマ峠の高火力エース。 |
| ASHHOUND | アッシュハウンド | 🐺 | FIRE | 灰原を駆ける高速アタッカー。 |
| FINBUB | フィンバブ | 🐟 | WATER | 泡を操る小魚。Lv17でグラシエラに進化。 |
| GLACIERA | グラシエラ | 🧊 | WATER | 高耐久の氷水モンスター。 |
| MISTRAY | ミストレイ | 🐬 | WATER | 霧の海を泳ぐ支援型。 |
| SPROUTLE | スプラウトル | 🌱 | GRASS | 芽吹きの精。Lv16でブルームラに進化。 |
| BLOOMRA | ブルームラ | 🌺 | GRASS | 花嵐で攻める上位種。 |
| MOSSHORN | モスホーン | 🫎 | GRASS | 高耐久の森の守護獣。 |
| SKYPIP | スカイピップ | 🕊️ | NORMAL | 風をまとう鳥。Lv18でオーロロに進化。 |
| AURORO | オーロロ | 🪽 | NORMAL | 遺跡上空の光翼モンスター。 |
| RUNEFOX | ルーンフォックス | 🦝 | NORMAL | 古代ルーンを操るトリッキー型。 |
| VOLTPUP | ボルトパピー | ⚡ | ELECTRIC | 電気犬。Lv14でショックハウンドに進化。 |
| SHOCKHOUND | ショックハウンド | 🐕 | ELECTRIC | 雷鳴を纏う猟犬。 |
| SPARKBUG | スパークバグ | 🪲 | ELECTRIC | 光る甲虫。素早さが高い。 |
| THUNDERAM | サンダーラム | 🐏 | ELECTRIC | 雷を蓄える羊。Lv17でストームラムに進化。 |
| STORMRAM | ストームラム | ⛈️ | ELECTRIC | 嵐を呼ぶ電撃エース。 |
| ZAPDRAKE | ザップドレイク | 🐲 | ELECTRIC | 雷竜。高火力アタッカー。 |
| PLASMOTH | プラズモス | 🦠 | ELECTRIC | プラズマ体の不思議な生物。 |
| FROSTKIT | フロストキット | 🐱 | ICE | 霜猫の子。Lv15でブリザキャットに進化。 |
| BLIZZCAT | ブリザキャット | ❄️ | ICE | 吹雪を纏う氷猫。 |
| ICEPECK | アイスペック | 🐧 | ICE | 氷原のペンギン。バランス型。 |
| CRYSTEEL | クリスティール | 🦂 | ICE | 氷の鎧をもつ蠍。高防御。 |
| SNOWFAWN | スノーフォーン | 🦌 | ICE | 雪原の子鹿。Lv16でフロストヴェールに進化。 |
| FROSTVEIL | フロストヴェール | 🦋 | ICE | 氷の結晶を纏う霜蝶。 |
| TUNDRABEAR | ツンドラベア | 🐻‍❄️ | ICE | 極寒の大熊。高耐久高火力。 |
| CHARCOIL | チャーコイル | 🐍 | FIRE | 灼熱の鱗を持つ火蛇。Lv18でサーパイロに進化。 |
| SERPYRO | サーパイロ | 🐉 | FIRE | 猛炎を吐く火竜蛇。チャーコイルの進化形。 |
| SOLFLARE | ソルフレア | ☀️ | FIRE | 太陽の欠片から生まれた神獣。 |
| CORALION | コラリオン | 🪸 | WATER | 珊瑚の鎧をまとった海の戦士。守りは鉄壁。 |
| ABYSSQUID | アビスクイッド | 🦑 | WATER | 深海の闇から襲う巨大イカ。 |
| WHALORD | ウェイロード | 🐳 | WATER | 海の王と呼ばれる巨大鯨。 |
| CACTURION | カクタリオン | 🌵 | GRASS | 乾燥地帯のサボテン戦士。トゲの反撃。 |
| FLORAMIS | フローラミス | 🍄 | GRASS | 胞子で仲間を呼ぶキノコの妖精。Lv17でファンゴリアに進化。 |
| FUNGORIA | ファンゴリア | 🍂 | GRASS | 秋の森を統べるキノコ王。フローラミスの進化形。 |
| GHOSTAIL | ゴーステイル | 👻 | NORMAL | 影に溶け込む幽霊のような獣。ダークタワーに出没。 |
| COSMOWL | コスモウル | 🦉 | NORMAL | 宇宙の知恵を持つ神秘のフクロウ。 |
| SPIRALHORN | スパイラルホーン | 🦬 | NORMAL | 螺旋の角で突進する巨獣。 |
| NEONRAY | ネオンレイ | 🐠 | ELECTRIC | 体がネオンのように光る深海魚。 |
| LIGHTNIX | ライトニクス | 🦅 | ELECTRIC | 雷雲を飛ぶ若鷲。Lv19でサンダグルに進化。 |
| THUNDAGLE | サンダグル | 🌩️ | ELECTRIC | 嵐の中で王として君臨する雷鷲。ライトニクスの進化形。 |
| POLARYX | ポラリクス | ⛄ | ICE | 永久凍土で生まれた雪の精霊。 |
| GLACIDRAKE | グラシドレイク | 🏔️ | ICE | 氷山を住処とする伝説の氷竜。 |
| ETERNIA | エテルニア | ✨ | NORMAL | 伝説のモンスター。エモじクリスタルの力で眠り続けた守護者。 |

#### 進化チェーン

- エムベア (Lv12) → パイアベア
- ドロプレット (Lv14) → タイダロン
- リーフリング (Lv13) → ソーンキング
- シンダーカブ (Lv16) → ヴォルカノックス
- フィンバブ (Lv17) → グラシエラ
- スカイピップ (Lv18) → オーロロ
- スプラウトル (Lv16) → ブルームラ
- ボルトパピー (Lv14) → ショックハウンド
- サンダーラム (Lv17) → ストームラム
- フロストキット (Lv15) → ブリザキャット
- スノーフォーン (Lv16) → フロストヴェール
- チャーコイル (Lv18) → サーパイロ
- フローラミス (Lv17) → ファンゴリア
- ライトニクス (Lv19) → サンダグル

---

### 5. 技一覧（68種）

| ID | 名前 | タイプ | 威力 | 命中 | PP | カテゴリ | 特殊効果 |
|----|------|--------|------|------|----|----------|----------|
| TACKLE | ラッシュタックル | NORMAL | 40 | 100 | 35 | 攻撃 | — |
| QUICK_ATTACK | スイフトダッシュ | NORMAL | 40 | 100 | 30 | 攻撃 | 先制 |
| BODY_SLAM | ヘビープレス | NORMAL | 80 | 90 | 15 | 攻撃 | — |
| HYPER_VOICE | ブラストボイス | NORMAL | 90 | 95 | 10 | 攻撃 | — |
| EMBER | スパークエンバー | FIRE | 40 | 100 | 25 | 攻撃 | やけど20% |
| FIRE_FANG | フレアファング | FIRE | 65 | 95 | 15 | 攻撃 | やけど25% |
| FLAME_BURST | かえんほうしゃ | FIRE | 90 | 100 | 15 | 攻撃 | — |
| INFERNO | えんごくほう | FIRE | 110 | 75 | 5 | 攻撃 | やけど50% |
| WATER_GUN | みずはじき | WATER | 40 | 100 | 25 | 攻撃 | — |
| AQUA_JET | ウォーターダッシュ | WATER | 40 | 100 | 20 | 攻撃 | 先制 |
| BUBBLE_BEAM | バブルレーザー | WATER | 65 | 100 | 20 | 攻撃 | — |
| HYDRO_PUMP | アビスノズル | WATER | 110 | 75 | 5 | 攻撃 | — |
| LEAF_DART | リーフダート | GRASS | 45 | 100 | 25 | 攻撃 | — |
| VINE_WHIP | ヴァインストライク | GRASS | 45 | 100 | 25 | 攻撃 | — |
| RAZOR_LEAF | リーフスラッシュ | GRASS | 55 | 95 | 25 | 攻撃 | — |
| SOLAR_BEAM | サンレイバースト | GRASS | 120 | 90 | 5 | 攻撃 | — |
| FOCUS | ちからをためる | NORMAL | 0 | — | 20 | 変化 | 攻撃+1段階 |
| DEFENSE_CURL | シェルガード | NORMAL | 0 | — | 20 | 変化 | 防御+1段階 |
| GROWL | よわきのこえ | NORMAL | 0 | — | 20 | 変化 | 相手攻撃-1段階 |
| HEAL_PULSE | いやしのはどう | NORMAL | 0 | — | 10 | 変化 | 自身HP25%回復 |
| STONE_BASH | ストーンバッシュ | NORMAL | 75 | 90 | 15 | 攻撃 | — |
| BLAZE_RUSH | ブレイズラッシュ | FIRE | 80 | 90 | 10 | 攻撃 | やけど20% |
| TIDAL_WAVE | タイダルウェーブ | WATER | 84 | 88 | 10 | 攻撃 | — |
| NATURE_GUARD | ネイチャーガード | GRASS | 0 | — | 10 | 変化 | 防御+1 & 自身HP15%回復 |
| TOXIC_STING | トキシックスパイク | GRASS | 40 | 100 | 25 | 攻撃 | どく30% |
| VENOM_BITE | ベノムバイト | NORMAL | 55 | 100 | 20 | 攻撃 | どく25% |
| SHADOW_CLAW | カゲヅメ | NORMAL | 65 | 100 | 15 | 攻撃 | — |
| MOONBEAM | ムーンビーム | NORMAL | 70 | 100 | 15 | 攻撃 | 特殊 |
| CINDER_SPIN | シンダースピン | FIRE | 48 | 95 | 20 | 攻撃 | やけど15% |
| LAVA_PRESS | ラヴァプレス | FIRE | 72 | 90 | 15 | 攻撃 | — |
| PHOENIX_FLARE | フェニックスフレア | FIRE | 88 | 82 | 6 | 攻撃 | やけど25% |
| STEAM_BLAST | スチームブラスト | WATER | 70 | 90 | 15 | 攻撃 | — |
| FROST_TIDE | フロストタイド | WATER | 82 | 86 | 10 | 攻撃 | — |
| OCEAN_BLESS | オーシャンブレス | WATER | 0 | — | 10 | 変化 | 防御+1 & 自身HP15%回復 |
| PETAL_STORM | ペタルストーム | GRASS | 78 | 88 | 10 | 攻撃 | — |
| ROOT_TRAP | ルートトラップ | GRASS | 0 | — | 15 | 変化 | 相手攻撃-1段階 |
| THORN_BARRAGE | ソーンバラージ | GRASS | 65 | 92 | 15 | 攻撃 | — |
| SKY_SLASH | スカイスラッシュ | NORMAL | 75 | 92 | 15 | 攻撃 | — |
| COMET_KICK | コメットキック | NORMAL | 80 | 88 | 8 | 攻撃 | — |
| SPIRIT_HOWL | スピリットハウル | NORMAL | 0 | — | 10 | 変化 | 相手攻撃-2段階 |
| IRON_HIDE | アイアンハイド | NORMAL | 0 | — | 10 | 変化 | 防御+1段階 |
| BRIGHT_HEART | ブライトハート | NORMAL | 0 | — | 10 | 変化 | 攻撃+1 & 自身HP15%回復 |
| SPARK | エレキスパーク | ELECTRIC | 40 | 100 | 25 | 攻撃 | まひ20% |
| THUNDER_FANG | らいでんのキバ | ELECTRIC | 55 | 95 | 15 | 攻撃 | まひ25% |
| THUNDERBOLT | ライトニングボルト | ELECTRIC | 75 | 100 | 15 | 攻撃 | まひ10% |
| THUNDER | らいげき | ELECTRIC | 95 | 75 | 5 | 攻撃 | まひ20% |
| VOLT_TACKLE | ボルトタックル | ELECTRIC | 50 | 100 | 20 | 攻撃 | 先制 |
| CHARGE | エネチャージ | ELECTRIC | 0 | — | 20 | 変化 | 攻撃+1段階 |
| DISCHARGE | プラズマバースト | ELECTRIC | 80 | 100 | 15 | 攻撃 | まひ15% |
| ICE_SHARD | フロストシャード | ICE | 40 | 100 | 30 | 攻撃 | 先制 |
| FROST_BITE | フロストバイト | ICE | 55 | 95 | 15 | 攻撃 | こおり15% |
| ICE_BEAM | コールドレイ | ICE | 75 | 100 | 15 | 攻撃 | こおり10% |
| BLIZZARD | ブリザードストーム | ICE | 95 | 75 | 5 | 攻撃 | こおり15% |
| FROST_BREATH | フロストブレス | ICE | 65 | 90 | 20 | 攻撃 | — |
| HAIL_SHELL | ひょうのこうら | ICE | 0 | — | 10 | 変化 | 防御+1段階 |
| AURORA_VEIL | オーロラシールド | ICE | 0 | — | 10 | 変化 | 防御+1 & 自身HP15%回復 |
| SOLAR_FLARE | ソーラーフレア | FIRE | 90 | 80 | 5 | 攻撃 | やけど30% |
| HEAT_COIL | ヒートコイル | FIRE | 60 | 95 | 15 | 攻撃 | — |
| DEEP_DIVE | ディープダイブ | WATER | 75 | 92 | 12 | 攻撃 | — |
| TIDAL_CRUSH | タイダルクラッシュ | WATER | 90 | 78 | 5 | 攻撃 | — |
| SPORE_CLOUD | スポアクラウド | GRASS | 0 | 75 | 10 | 変化 | ねむり100% |
| FUNGAL_BURST | ファンガルバースト | GRASS | 72 | 90 | 10 | 攻撃 | — |
| PHANTOM_RUSH | ファントムラッシュ | NORMAL | 70 | 95 | 12 | 攻撃 | — |
| COSMIC_RAY | コスミックレイ | NORMAL | 85 | 85 | 8 | 攻撃 | — |
| STORM_WING | ストームウイング | ELECTRIC | 72 | 90 | 12 | 攻撃 | — |
| PLASMA_CANNON | プラズマキャノン | ELECTRIC | 92 | 78 | 5 | 攻撃 | まひ25% |
| FROST_QUAKE | フロストクエイク | ICE | 78 | 88 | 10 | 攻撃 | — |
| ETERNAL_LIGHT | エターナルライト | NORMAL | 100 | 85 | 3 | 攻撃 | エテルニア専用技 |

---

### 6. アイテム一覧（27種）

| ID | 名前 | 絵文字 | 価格 | 効果 |
|----|------|--------|------|------|
| POTION | ヒールジェル | 🧪 | 50G | HP20回復 |
| SUPER_POTION | ハイヒールジェル | 💊 | 150G | HP50回復 |
| HYPER_POTION | メガヒールジェル | 🧴 | 360G | HP100回復 |
| MEGA_POTION | アルティメットジェル | 💉 | 700G | HP160回復 |
| FULL_HEAL | エリクサー | ✨ | 260G | HP80回復 |
| FULL_RESTORE | パーフェクトケア | 🌟 | 950G | HP全回復+状態異常回復 |
| BURN_HEAL | ヒートケア | 💦 | 80G | やけど状態回復 |
| PARALYZE_HEAL | スパークケア | 🔋 | 80G | まひ状態回復 |
| ICE_HEAL | フリーズケア | 🫧 | 80G | こおり状態回復 |
| AWAKENING | めざましくすり | ☕ | 80G | ねむり状態回復 |
| ANTIDOTE | デトックスハーブ | 💚 | 80G | どく状態回復 |
| POWER_SEED | ちからのタネ | 🌱 | 100G | 攻撃+1段階 |
| RAGE_CANDY | げきりんキャンディ | 🍬 | 180G | 攻撃+1段階 |
| IRON_SEED | てつのタネ | 🛡️ | 100G | 防御+1段階 |
| GUARD_CHARM | ガードチャーム | 🪬 | 180G | 防御+1段階 |
| X_SPEED | クイックステップ | 💨 | 120G | 素早さ+1段階 |
| EMO_BALL | エモボール | ⚪ | 120G | 野生モンスター捕獲 |
| GREAT_BALL | ハイキャッチボール | 🔵 | 300G | 捕獲率1.4倍 |
| ULTRA_BALL | エリートボール | 🟡 | 650G | 捕獲率1.8倍 |
| MASTER_BALL | インフィニティボール | 🟣 | 9999G | 確定捕獲 |
| REVIVE | リバイブシャード | 💖 | 500G | 瀕死パーティ復活(HP50%) |
| SPEED_CANDY | スピードキャンディ | 🍭 | 200G | 素早さ+2段階 |
| POWER_CHARM | パワーチャーム | 💪 | 250G | 攻撃+2段階 |
| IRON_WALL | てっぺきチャーム | 🔱 | 250G | 防御+2段階 |
| FULL_REVIVE | かんぜんリバイブ | 💗 | 1200G | 瀕死パーティ復活(HP100%) |
| HYPER_BALL | ハイパーボール | 🟠 | 1200G | 捕獲率2.5倍 |
| ETHER | エーテル | 🫙 | 200G | 全技のPPを10回復 |
| MAX_ELIXIR | マックスエリクサー | 🧫 | 600G | 全技のPPを完全回復 |

---

### 7. NPC と施設

#### ショップ

- エモじタウンのショップNPC（青いNPC）に話しかけると購入メニュー。
- 全23種のアイテムを販売（エーテル・マックスエリクサーを含む）。
- ↑↓で選択、Zで購入、Xで閉じる。

#### 回復NPC

- おうちのNPCに話しかけるとパーティ全員のHP・PPが全回復、状態異常も回復。

#### クエストNPC

- 「スターライトをつれてきて」クエスト。
- パーティにスターライトを持って話しかけると100G報酬。
- `gameState.starQuestDone` で完了管理。

#### ジム

- エモの森にジムタイル(6)あり。
- 未クリア時にジムタイルに入るとジムリーダー戦（パイアベア Lv.15）。
- 勝利時: ジムバッジ獲得、30倍の報酬金、`gameState.gymCleared` フラグ。

#### 第2ジム（氷峰）

- 氷峰にジムタイル(6)あり。
- ジムリーダー ユキハ（ツンドラベア Lv.32）。
- 勝利時: アイスバッジ獲得、`gameState.storyFlags.frozenPeakGymCleared` フラグ。

#### アイスタイプクエスト（氷峰）

- 氷峰のNPCに話しかけると、こおりタイプのモンスターを求められる。
- パーティにICEタイプがいれば達成: ハイパーボール ×3 + 500G。

#### チャンピオン戦（天空の花園）

- クリア後エリアにチャンピオン アキラが待つ。
- Lv.45 の最強トレーナーバトル。
- エテルニア（伝説のモンスター Lv.45）との野生バトルも発生可能。

#### 闘技場（バトルアリーナ）

- きらめき洞窟のNPC（座標 5,5）に話しかけると闘技場チャレンジ開始。
- 3ラウンド連戦方式。逃走・捕獲不可。
- ラウンドごとに対戦相手のレベルが上昇（Lv13 → Lv16 → Lv19）。
- 経験値は通常の10倍。
- 3勝クリア報酬: 500G + ラウンド数 × 100G（合計800G）。
- 最高連勝記録が `gameState.arenaHighScore` に保存される。
- トレーナー画面に闘技場の最高記録が表示される。

---

### 8. セーブ/ロード

- **セーブ**: フィールドでSキーを押すとLocalStorageに保存。
- **ロード**: タイトル画面の「つづきから」で復元。
- **保存データ**:
  - パーティ（種族ID・レベル・HP・経験値・PP配列）
  - ボックス（パーティ上限6体超過分の保管）
  - インベントリ
  - プレイヤー位置・マップ
  - 所持金
  - ジムクリア・クエスト完了フラグ
  - ストーリー進行フラグ（15項目）
  - 闘技場連勝数・最高記録
  - 図鑑データ（見た/捕まえた）
  - プレイ時間・バトル数・捕獲数
- **キー**: `emojimon_save_v2`

補助設定データ:
- 音声設定（ミュート/BGM音量/SE音量）を `emojimon_settings_v1` に保存。

---

### 9. サウンドシステム

Web Audio API を使用した手続き的サウンド生成（AudioManager）。

#### BGM

| シーン | メソッド |
|--------|---------|
| タイトル | `playTitleBgm()` |
| フィールド（タウン/研究所/おうち） | `playFieldBgm()` |
| エモの森 | `playForestBgm()` |
| きらめき洞窟 | `playCaveBgm()` |
| ダークタワー | `playDarkBgm()` |
| マグマ峠 | `playVolcanoBgm()` |
| 氷峰 | `playIceBgm()` |
| そらの遺跡・天空の花園 | `playRuinsBgm()` |
| バトル | `playBattleBgm()` |

エリア移動時は `playAreaBgm(mapKey)` が自動的に対応BGMを選択・切替する。

#### 音量設定

- タイトル画面「サウンド設定」で、ミュート切替・BGM音量・SE音量を調整可能。
- 設定は即時反映され、次回起動時にも維持される。

#### SE

| 効果音 | トリガー |
|--------|---------|
| カーソル移動 | メニュー↑↓ |
| 決定 | Z/Space |
| キャンセル | X |
| 攻撃ヒット | ダメージ発生時 |
| 効果抜群 | 相性2倍以上 |
| レベルアップ | Lv上昇時 |
| 捕獲成功 | モンスター捕獲時 |
| 勝利 | バトル勝利時 |
| 敗北 | バトル敗北時 |
| 歩行 | 2歩ごと |
| ドア | マップ遷移時 |
| 購入 | ショップ購入時 |
| エラー | 所持金不足時 |
| セーブ | セーブ実行時 |
| エンカウント | 野生出現時 |
| 回復 | HP回復時 |

---

### 10. 演出・アニメーション

- **エンカウント**: 画面フラッシュ → フェードアウト。
- **エンカウント（刷新）**: フラッシュに加えてプレイヤー中心の光バーストと走査線ワイプで戦闘遷移を強調。
- **マップ遷移**: フェードアウト/フェードイン（300〜400ms）。
- **バトル入場**: プレイヤーモンスターが左からスライドイン、相手モンスターが右からスケールアップしながらスライドイン（GSAP back.out イージング）。入場完了後に呼吸アニメーション開始。
- **攻撃演出**: 絵文字キャラの突進 → ターゲット点滅 → パーティクル散布。
- **ダメージ数字**: 浮遊して消えるテキスト（効果抜群時はオレンジ色・拡大）。
- **HPバー**: Tween アニメーション（500ms）。
- **草むら**: 微揺れアニメーション。
- **キャラクター**: 呼吸アニメーション（スケール変動）。
- **カメラ**: ヒット時に画面シェイク。
- **天候パーティクル**: 雨（斜め雨粒 + 青オーバーレイ）、晴れ（斜め光線 + 暖色オーバーレイ + ゆらめき）、風（葉っぱパーティクル + 風線）。天候変化時にパーティクルが動的に切り替わる。
- **状態異常バッジ**: やけど🔥 / どく☠️ / まひ⚡ / こおり🧊 / ねむり💤 のアイコンバッジがモンスター絵文字の下にパルスアニメーションで表示。
- **捕獲ボール演出**: ボール絵文字が放物線を描いて飛ぶ → 相手モンスターが吸い込まれる → ボールが揺れる（成功時3回 / 失敗時1〜2回）→ 成功時キラキラエフェクト / 失敗時ボール弾け + モンスター再出現。

---

### 11. UI 仕様

- **解像度**: 800x480（レスポンシブ中央配置）。
- **フォント**: M PLUS Rounded 1c（Google Fonts CDN、ウェイト 400/500/700/800）。フォールバック: "Helvetica Neue", Arial, sans-serif。
- **カラースキーム**: ダークテーマ（#020617 背景、#fbbf24 ハイライト）。UIHelper.ts の `COLORS` / `TEXT_COLORS` で一元管理。
- **パネルスタイル**: ドロップシャドウ + ヘッダーグラデーション + インナーグロー + 細線ボーダーのガラス調パネル。`drawPanel()` ヘルパーで統一描画。
- **選択状態**: アウターグロー付き行ハイライト + ボーダー。`drawSelection()` ヘルパーで統一描画。
- **rexUI 適用領域**: タイトルのサウンド設定/ヘルプパネル、バトルのコマンド/わざ/アイテム/いれかえメニュー行、わざ詳細カードは `phaser3-rex-plugins` の `Sizer + roundRectangle` レイアウトで描画。

#### フィールドUI

- 上部: エリア名 + 操作ヘルプ。
- パーティバー: 絵文字 + Lv + HP%。
- 下部: 情報パネル（状況メッセージ + 所持金）。
- 右上ミニマップ: ラベル表示とプレイヤーのリングパルス。

#### バトルUI

- プレイヤー情報パネル: 名前・Lv・HPバー・EXPバー・ステージ表示。
- 相手情報パネル: 名前・Lv・HPバー。
- メッセージパネル: 左側にテキスト、右側にコマンドメニュー。
- ▼ インジケーター: メッセージ送り表示。

---

### 12. テクスチャ生成

すべて Phaser Graphics API で手続き生成（外部画像不要）。

| テクスチャ | 説明 |
|-----------|------|
| tile-ground | ノイズドット付きの地面 |
| tile-grass | 三角形の草模様 |
| tile-wall | レンガパターン |
| tile-floor | チェッカー模様の床 |
| tile-door | ドアノブ付きのドア |
| tile-forest | 木の形状 |
| tile-water | 波模様 |
| tile-gym | 星マーク |
| tile-path | 石畳風 |
| player | 影とハイライト付きキャラ |
| npc | 表情付き（ほほ赤・笑顔） |
| npc-shop | 帽子付き（青色） |
| npc-quest | !マーク付き（紫色） |
| particle-* | タイプ別パーティクル |

---

## 技術仕様

### 使用技術

- **ゲームエンジン**: Phaser 3 v3.80.0（CDN）
- **言語**: TypeScript（ES Modules）
- **開発/ビルド**: Vite（`npm run dev` / `npm run build`）
- **品質ツール**: ESLint / TypeScript / Vitest
- **UI拡張**: GSAP（モーション演出） / phaser3-rex-plugins（UIコンポーネント）
- **データ検証**: Zod（起動時に JSON スキーマを検証）
- **オーディオ**: Web Audio API（手続き生成）
- **データ保存**: LocalStorage

### ディレクトリ構成

```
./
  index.html              … エントリー HTML（モバイル対応・PWAメタタグ）
  package.json            … 依存関係・起動スクリプト
  assets/data/
    monsters.json          … モンスター定義
    moves.json             … 技定義
    items.json             … アイテム定義
    abilities.json         … 特性定義
  js/
    main.ts                … Phaser.Game 構成
    audio/
      AudioManager.ts      … 手続き的サウンドシステム
    data/
      moves.ts             … 技データ初期化ロジック
      monsters.ts          … モンスターロジック・進化・野生生成
      items.ts             … アイテムロジック
      dataValidation.ts    … Zodによるゲームデータ検証
      mapRules.ts          … マップ依存ルール（遭遇・天候・背景テーマ）
    scenes/
      BootScene.ts         … テクスチャ生成・データ読込
      TitleScene.ts        … タイトル画面・メニュー
      WorldScene.ts        … フィールド移動の中核・各機能呼び出し
      world/
        worldMapData.ts    … マップ/NPC/ドア遷移/地形定義
        worldShop.ts       … ショップUI・購入入力処理
      BattleScene.ts       … バトル進行の中核・各機能呼び出し
      battle/
        battleConstants.ts … バトル定数/状態/バランス定数/表示ヘルパー
        battleMenu.ts      … コマンドメニュー描画・選択UI
      MenuScene.ts         … ゲーム内メニューの中核・入力処理
      menu/
        menuConstants.ts   … メニュー定数/ガイドページ文言
        menuViews.ts       … 各サブ画面（パーティ/バッグ/図鑑/設定）描画
    state/
      gameState.ts         … グローバル状態・セーブ/ロード
    ui/
      TouchControls.ts     … モバイル仮想コントローラー
      UIHelper.ts          … UIデザインシステム（カラー/パネル/選択描画）
  types/
    game.d.ts              … TypeScript型定義（MonsterSpecies/Move/Item/BattleData等）
```

---

## 操作方法

| キー | フィールド | バトル | メニュー |
|------|-----------|--------|---------|
| ←↑→↓ / WASD | 移動 | — | 項目選択（↑↓ / WS） |
| Z / Space | NPC会話 | 決定 / 次へ | 決定 |
| X / ESC | メニューを開く | キャンセル | 戻る |
| P | セーブ | — | — |

**モバイル操作**: タッチデバイスでは仮想D-padとA/Bボタンが自動表示されます。

---

## 実行方法

```bash
npm install
npm run dev
```

ブラウザで表示されたローカルURLにアクセス（通常は `http://localhost:5173`）。

品質確認と本番ビルド:

```bash
npm run lint
npm run typecheck
npm run test
npm run build
npm run preview
```

---

## ストーリーシステム（v1.1 追加）

### メインストーリー「エモじ伝説 〜はじまりの炎〜」

#### あらすじ
エモじタウンのハカセから相棒モンスターを授かった主人公は、
悪の組織「ダーク団」が 5 つの**エモじクリスタル**を奪おうとしていると知る。
ライバル「レン」と競いながら各エリアを旅し、世界の平和を守れ！

#### ストーリー進行フラグ（gameState.storyFlags）

- `introNarrationDone` : 初回ナレーション済み（チュートリアル）
- `prologueDone` : 博士とのプロローグ完了
- `starterChosen` : スターター選択済み
- `rivalIntroDone` : ライバル「レン」との初対面済み
- `momFarewellDone` : 母の見送りイベント済み（チュートリアル）
- `tutorialMoveDone` : 移動チュートリアル済み
- `tutorialBattleDone` : 初回バトルチュートリアル済み
- `tutorialCatchDone` : 捕獲チュートリアル済み
- `tutorialMenuDone` : メニューチュートリアル済み
- `townRivalBeaten` : エモじタウンでライバルを撃破
- `forestCrystalFound` : 森の守護者を倒してクリスタル入手 [1/5]
- `forestRivalBeaten` : 森でライバルを撃破
- `caveEvilBeaten` : 洞窟でダーク団幹部「シャドウ」を撃破 [2/5]
- `caveRivalBeaten3` : 洞窟奥でライバル3戦目
- `darkTowerGruntBeaten` : ダークタワーでダーク団下っ端を撃破
- `darkTowerVoidBeaten` : ダークタワーで幹部「ヴォイド」を撃破 [3/5]
- `volcanoEvilBossBeaten` : マグマ峠でダーク団ボス「ライオット」を撃破 [4/5]
- `frozenPeakGymCleared` : 氷峰ジムリーダー ユキハを撃破
- `frozenPeakRivalBeaten` : 氷峰でライバル戦
- `frozenPeakIceQuest` : 氷峰のこおりタイプクエスト達成
- `ruinsFinalDone` : 遺跡で最終決戦クリア [5/5]
- `legendaryDefeated` : 天空の花園でエテルニアと対決

#### 初回チュートリアルフロー（v1.2 追加）

```
1. タイトル画面で「はじめから」→ ゲーム内キーボードで名前入力（最大8文字）
2. エモじタウン出現 → 自動ナレーション（世界観紹介・操作ヒント）
3. 母親NPC（家の前）に話しかける → 研究所への案内
4. 博士の町ヒントNPC → 研究所へ誘導
5. 研究所に入り 博士に話す → 詳細プロローグ（世界観・クリスタル・ダーク団）
6. 3体のスターターから相棒を選択（各スターターに個性的な紹介文付き）
7. スターター選択後 → 操作ガイド（移動/会話/メニュー/セーブ/バトル基礎）
8. タウンに戻ると:
   - 助手アユム NPC → バトル/タイプ相性チュートリアル
   - 母親NPC → 見送りイベント（ヒールジェル×3 贈呈）
   - ライバル レンNPC → 初対面ストーリー → 初トレーナーバトル
9. 初回野生バトル → バトルチュートリアル（コマンド操作説明）
10. 初勝利後 → 経験値/レベルアップ説明 + 捕獲のコツ
11. 初捕獲成功 → パーティ確認/メニュー案内
12. 助手アユム → 捕獲チュートリアル（詳細）
```

#### ストーリールート

```
エモじタウン（プロローグ・スターター選択・ライバル戦）
    ↓
エモの森（クリスタル1/5・ジム1・ライバル2戦目）
    ↓
きらめき洞窟（クリスタル2/5・闘技場・ライバル3戦目）
    ├→ ダークタワー（サイドルート・クリスタル3/5・幹部ヴォイド戦）
    ↓
マグマ峠（クリスタル4/5・ダーク団ボス ライオット戦）
    ↓
氷峰（ジム2・ユキハ戦・ライバル戦・アイスクエスト）
    ↓
そらの遺跡（クリスタル5/5・最終決戦）
    ↓（クリア後）
天空の花園（伝説のエテルニア・チャンピオン アキラ戦）
```

#### 主要キャラクター

| キャラ | 役割 | 備考 |
|--------|------|------|
| ハカセ | エモじ研究所の博士 | プロローグ進行、スターター授与 |
| アユム | 博士の助手 | チュートリアルガイド（研究所＆町） |
| ママ | 主人公の母 | 見送りイベント、家で回復 |
| レン | ライバル | 各エリアで繰り返しバトル |
| シャドウ | ダーク団幹部 | 洞窟でクリスタル[2/5]を守る |
| ヴォイド | ダーク団幹部 | ダークタワーでクリスタル[3/5]を守る |
| ライオット | ダーク団ボス | マグマ峠[4/5]と遺跡[5/5]で対決 |
| ユキハ | 氷峰ジムリーダー | 第2ジムバッジ |
| アキラ | チャンピオン | クリア後挑戦 |
| エテルニア | 伝説のモンスター | ストーリークリアでパーティ加入 |

#### 新マップ: エモじ研究所（LAB）

- 14×10の室内マップ
- エモじタウン右上の建物ドア（x=20, y=4）から入れる
- ハカセ NPC がプロローグ進行・スターター選択（3択）を担当
- 助手アユム NPC がチュートリアルサポート
- スターター: エムベア🧸(炎) / フィンバブ🐟(水) / ソーンバイン🌿(草)

#### 会話シーケンスシステム

WorldScene.showDialogSequence(lines, onComplete) で複数行の会話を実装。
Zキーで次行へ進み、完了後 onComplete コールバックを呼び出す。

#### トレーナーバトルシステム

NPC に rivalBattle プロパティを持たせてトレーナー戦を発生させる。
バトル後、_checkTrainerBattleResult でストーリーフラグを更新し
NPCの台詞・出現状態が変化する。

